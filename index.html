<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caro Web</title>
  <style>
    :root{--bg:#0f1724;--card:#071428;--accent:#00d1b2;--muted:#9aa7b2;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,var(--bg), #071023);color:#e6f0f2;display:flex;align-items:flex-start;justify-content:center;padding:24px}
    .container{width:1100px;max-width:100%;display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:linear-gradient(180deg,var(--card), #021226);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:#062123;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}

    .board{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;width:420px;max-width:100%;margin:0 auto}

    .cell{
      aspect-ratio:1/1;background:var(--glass);border-radius:10px;
      display:flex;align-items:center;justify-content:center;
      font-size:56px;cursor:pointer;user-select:none;
      transition:0.2s;
    }
    .cell.disabled{opacity:0.6;cursor:not-allowed}

    /* ⭐ X màu đỏ – O màu xanh dương */
    .cell.x{color:#ff4444}
    .cell.o{color:#4aa3ff}

    /* ⭐ highlight khi thắng */
    .win{
      background:#ffe680 !important;
      box-shadow:0 0 15px #ffe680;
    }

    .side{display:flex;flex-direction:column;gap:12px}
    .stat{font-size:14px;color:var(--muted)}
    .score{font-size:28px;font-weight:800;color:var(--accent)}
    .modes{display:flex;gap:8px;flex-wrap:wrap}
    select,input[type=radio]{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit;padding:8px;border-radius:8px}
    footer{margin-top:12px;color:var(--muted);font-size:13px;text-align:center}
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h1>XO — Tic-Tac-Toe (3x3)</h1>
        <div class="controls">
          <button id="newBtn">Trò mới (3×3)</button>
          <button id="openBig" class="ghost">Mở N×N (trang riêng)</button>
        </div>
      </header>

      <div style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap">
        <div style="flex:1;min-width:280px">
          <div style="display:flex;flex-direction:column;align-items:center;gap:12px">
            <div class="board" id="board" role="grid"></div>
            <div style="display:flex;align-items:center;gap:12px">
              <div class="stat">Lượt: <strong id="turnTxt">—</strong></div>
              <div class="stat">Trạng thái: <span id="statusTxt">Sẵn sàng</span></div>
            </div>
          </div>
        </div>

        <div style="width:360px">
          <aside class="side">
            <div class="card" style="padding:12px">
              <div style="font-size:14px;color:var(--muted)">Chế độ</div>
              <div class="modes" style="margin-top:8px">
                <label><input type="radio" name="mode" value="pvp" checked> Hai người</label>
                <label><input type="radio" name="mode" value="ai"> Máy</label>
              </div>

              <div style="margin-top:10px">
                <div style="font-size:14px;color:var(--muted)">Độ khó</div>
                <select id="aiLevel" style="margin-top:8px">
                  <option value="easy">Dễ</option>
                  <option value="hard">Khó (Minimax)</option>
                </select>
              </div>
            </div>

            <div class="card" style="padding:12px">
              <div style="font-size:14px;color:var(--muted)">Điểm</div>
              <div style="display:flex;gap:12px;margin-top:8px">
                <div><div class="stat">X</div><div class="score" id="scoreX">0</div></div>
                <div><div class="stat">O</div><div class="score" id="scoreO">0</div></div>
              </div>
            </div>

            <div class="card" style="padding:12px">
              <div class="small">Mở Caro N×N trong trang mới:</div>
              <input id="bigN" type="number" min="3" max="15" value="5" style="margin-top:8px;width:80px">
              <button id="openBig2" class="ghost" style="margin-top:8px">Mở N×N</button>
            </div>
          </aside>
        </div>
      </div>

      <footer>Chơi với máy bằng chế độ "Máy".</footer>
    </div>
  </div>

  <script>
    const boardEl = document.getElementById('board');
    const turnTxt = document.getElementById('turnTxt');
    const statusTxt = document.getElementById('statusTxt');
    const aiLevelSel = document.getElementById('aiLevel');
    const modeRadios = document.getElementsByName('mode');
    const scoreXEl = document.getElementById('scoreX');
    const scoreOEl = document.getElementById('scoreO');

    const openBig = document.getElementById('openBig');
    const openBig2 = document.getElementById('openBig2');
    const bigN = document.getElementById('bigN');

    let board = Array(9).fill(null);
    let running = false;
    let current = 'X';
    let scores = {X:0, O:0};

    function getMode(){
      for(const r of modeRadios) if(r.checked) return r.value;
      return 'pvp';
    }

    function createBoard(){
      boardEl.innerHTML = '';
      for(let i=0;i<9;i++){
        const cell = document.createElement('div');
        cell.className = 'cell';
        cell.dataset.index = i;
        cell.addEventListener('click', onCell);
        boardEl.appendChild(cell);
      }
    }

    function onCell(e){
      const i = Number(e.currentTarget.dataset.index);
      if(board[i] || !running) return;
      makeMove(i, current);

      if(running && getMode()==='ai' && current==='O'){
        setTimeout(aiMove, 200);
      }
    }

    function startGame(){
      board = Array(9).fill(null);
      running = true;
      current = 'X';
      updateBoard();
      turnTxt.textContent = current;
      statusTxt.textContent = 'Đang chơi';
    }

    function makeMove(i, p){
      board[i] = p;
      updateBoard();
      const result = checkWinner(board);
      if(result){
        endGame(result === 'draw' ? null : result);
      } else {
        current = (p==='X')?'O':'X';
        turnTxt.textContent = current;
      }
    }

    function checkWinner(b){
      const winLines = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for(const line of winLines){
        const [a,b1,c] = line;
        if(b[a] && b[a]===b1 && b1===c);
      }
      for(const [a,c,d] of winLines){
        if(b[a] && b[a]===b[c] && b[c]===b[d]) {
          highlightWin([a,c,d]);
          return b[a];
        }
      }
      if(b.every(v=>v!==null)) return 'draw';
      return null;
    }

    /* ⭐ Highlight 3 ô thắng */
    function highlightWin(cells){
      const children = boardEl.children;
      for(const i of cells){
        children[i].classList.add("win");
      }
    }

    function updateBoard(){
      const cells = boardEl.children;
      for(let i=0;i<9;i++){
        cells[i].textContent = board[i] ?? '';
        cells[i].className = "cell";
        if(board[i]==="X") cells[i].classList.add("x");
        if(board[i]==="O") cells[i].classList.add("o");
        if(board[i] || !running) cells[i].classList.add("disabled");
      }
    }

    function endGame(w){
      running = false;
      if(w){
        statusTxt.textContent = "Thắng: "+w;
        scores[w]++; 
        scoreXEl.textContent = scores.X;
        scoreOEl.textContent = scores.O;
      } else {
        statusTxt.textContent = "Hòa";
      }
      turnTxt.textContent = '—';
    }

    function aiMove(){
      const level = aiLevelSel.value;
      let m;
      if(level==='easy'){
        const e = board.map((v,i)=>v===null?i:null).filter(v=>v!==null);
        m = e[Math.floor(Math.random()*e.length)];
      } else {
        m = bestMove(board,'O');
      }
      if(m!==undefined) makeMove(m,'O');
    }

    function bestMove(b, ai){
      let bestScore=-Infinity, best=null;
      for(let i=0;i<9;i++){
        if(b[i]===null){
          b[i]=ai;
          const s=minimax(b,0,false,ai);
          b[i]=null;
          if(s>bestScore){bestScore=s; best=i;}
        }
      }
      return best;
    }

    function minimax(b,d,isMax,ai){
      const w=checkWinner(b);
      if(w===ai) return 10-d;
      if(w && w!=='draw') return d-10;
      if(w==='draw') return 0;
      const hu = ai==='X'?'O':'X';

      if(isMax){
        let val=-Infinity;
        for(let i=0;i<9;i++){
          if(b[i]===null){
            b[i]=ai;
            val=Math.max(val,minimax(b,d+1,false,ai));
            b[i]=null;
          }
        }
        return val;
      } else {
        let val=Infinity;
        for(let i=0;i<9;i++){
          if(b[i]===null){
            b[i]=hu;
            val=Math.min(val,minimax(b,d+1,true,ai));
            b[i]=null;
          }
        }
        return val;
      }
    }

    document.getElementById('newBtn').onclick = startGame;
    openBig.onclick = ()=>window.open("xo_big.html","_blank");
    openBig2.onclick = ()=>{
      const n = Math.max(3, Math.min(15, Number(bigN.value)||5));
      window.open("xo_big.html?n="+n, "_blank");
    };

    createBoard();
    startGame();
  </script>
</body>
</html>
