<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>XO N×N — phiên bản Pygame chuyển sang HTML/Canvas</title>
  <style>
    body{margin:0;background:#0b1220;color:#e6f0f2;font-family:Arial, Helvetica, sans-serif;display:flex;align-items:center;justify-content:center;height:100vh}
    .wrap{background:linear-gradient(180deg,#071428,#021226);padding:18px;border-radius:12px;box-shadow:0 10px 40px rgba(0,0,0,0.6);width:min(920px,96%)}
    header{display:flex;justify-content:space-between;align-items:center}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    button{padding:8px 10px;border-radius:8px;border:none;background:#00d1b2;color:#062123;font-weight:700;cursor:pointer}
    input, select{padding:6px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    canvas{display:block;margin-top:12px;background:#fff;border-radius:8px}
    .info{margin-top:10px;color:#9aa7b2}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>XO N×N — Pygame → HTML</h1>
      <div class="controls">
        <label>Kích thước N: <input id="Ninp" type="number" min="3" max="9" value="5" style="width:70px;margin-left:6px"></label>
        <button id="start">Khởi động</button>
        <button id="reset" style="background:transparent;border:1px solid rgba(255,255,255,0.06);color:#9aa7b2">Làm lại</button>
      </div>
    </header>

    <canvas id="canvas" width="600" height="600"></canvas>
    <div class="info">
      <div id="msg">Lượt: — | WinNeed: —</div>
      <div id="status"></div>
    </div>
  </div>

  <script>
    // Logic chuyển từ Pygame sang Canvas
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const Ninp = document.getElementById('Ninp');
    const startBtn = document.getElementById('start');
    const resetBtn = document.getElementById('reset');
    const msg = document.getElementById('msg');
    const status = document.getElementById('status');

    let N = Number(Ninp.value) || 5;
    let winNeed = 4;
    let board = [];
    let player = 'X';
    let gameOver = false;

    function calcWinNeed(n){ if(n<=4) return 3; if(n==5) return 4; return 5; }
    function resizeCanvas(n){ const size = Math.min(800, Math.max(300, n*90)); canvas.width = size; canvas.height = size; }

    function init(n){ N = n; winNeed = calcWinNeed(N); board = Array.from({length:N}, ()=>Array(N).fill(' ')); player='X'; gameOver=false; resizeCanvas(N); render(); updateMsg(); status.textContent=''; }

    function render(){ ctx.fillStyle='#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height); const cell=canvas.width/N; ctx.strokeStyle='#000'; ctx.lineWidth = Math.max(1, Math.round(canvas.width/300)); for(let i=1;i<N;i++){ ctx.beginPath(); ctx.moveTo(i*cell,0); ctx.lineTo(i*cell,canvas.height); ctx.stroke(); ctx.beginPath(); ctx.moveTo(0,i*cell); ctx.lineTo(canvas.width,i*cell); ctx.stroke(); }
      ctx.font = Math.floor(cell*0.7)+'px Arial'; ctx.textAlign='center'; ctx.textBaseline='middle'; for(let i=0;i<N;i++){ for(let j=0;j<N;j++){ const v = board[i][j]; if(v!==' '){ ctx.fillStyle = v==='X'? '#d33':'#1363d4'; ctx.fillText(v, j*cell+cell/2, i*cell+cell/2 + cell*0.03); } } } }

    function checkWin(b){ const dx=[0,1,1,-1]; const dy=[1,0,1,1]; for(let i=0;i<N;i++){ for(let j=0;j<N;j++){ if(b[i][j]===' ') continue; const c=b[i][j]; for(let d=0;d<4;d++){ let cnt=0; let x=i,y=j; while(x>=0 && x<N && y>=0 && y<N && b[x][y]===c){ cnt++; if(cnt>=winNeed) return c; x+=dx[d]; y+=dy[d]; } } } } return ' '; }
    function boardFull(b){ for(const r of b) if(r.includes(' ')) return false; return true; }

    canvas.addEventListener('click', (ev)=>{ if(gameOver) return; const rect = canvas.getBoundingClientRect(); const x=ev.clientX-rect.left; const y=ev.clientY-rect.top; const cell = canvas.width/N; const j=Math.floor(x/cell); const i=Math.floor(y/cell); if(i<0||i>=N||j<0||j>=N) return; if(board[i][j]===' '){ board[i][j]=player; const w = checkWin(board); if(w!==' '){ gameOver=true; status.textContent = `Người chơi ${w} thắng!`; } else if(boardFull(board)){ gameOver=true; status.textContent = 'Hòa!'; } else { player = player==='X'?'O':'X'; } render(); updateMsg(); } });

    function updateMsg(){ msg.textContent = `Lượt: ${player} | WinNeed: ${winNeed} | Kích thước: ${N}×${N}`; }

    startBtn.addEventListener('click', ()=>{ const n = Math.max(3, Math.min(9, Number(Ninp.value)||5)); init(n); });
    resetBtn.addEventListener('click', ()=>{ init(N); });

    // init default
    init(N);
  </script>
</body>
</html>
