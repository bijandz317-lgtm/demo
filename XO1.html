<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>Caro – Trang chính</title>
<style>
    body { font-family: Arial; text-align: center; background: #f2f2f2; }

    h1 { margin-top: 20px; }

    .board { display: grid; margin: 20px auto; gap: 5px; }

    .cell {
        width: 100px; height: 100px; background: white;
        display: flex; justify-content: center; align-items: center;
        font-size: 60px; cursor: pointer;
        border: 2px solid black; user-select: none;
    }

    #nBoardArea { margin-top: 30px; }
</style>
</head>
<body>

<h1>Game Caro – Trang chính</h1>

<h2>Chế độ 3×3</h2>
<div id="board3" class="board"></div>

<button onclick="reset3()">Chơi lại 3×3</button>

<hr>

<h2>Chế độ N×N (hiển thị tại chỗ)</h2>
<input type="number" id="sizeN" placeholder="Nhập N" style="font-size:16px;" />
<button onclick="createNBoard()">Tạo bàn N×N</button>

<div id="nBoardArea"></div>

<br>
<button onclick="window.open('xo_big.html', '_blank')">
    Mở N×N trang riêng
</button>

<script>
// ===========================
// GAME 3×3
// ===========================
let board3 = [];
let turn3 = "X";

function init3() {
    const b = document.getElementById("board3");
    b.style.gridTemplateColumns = "repeat(3, 100px)";
    b.innerHTML = "";

    board3 = [
        ["", "", ""],
        ["", "", ""],
        ["", "", ""]
    ];

    for (let i = 0; i < 3; i++)
        for (let j = 0; j < 3; j++) {
            const c = document.createElement("div");
            c.className = "cell";
            c.onclick = () => click3(i, j, c);
            b.appendChild(c);
        }
}

function click3(i, j, cell) {
    if (board3[i][j] !== "") return;

    board3[i][j] = turn3;
    cell.textContent = turn3;

    if (checkWin3(turn3)) {
        alert(turn3 + " thắng!");
        return;
    }

    turn3 = turn3 === "X" ? "O" : "X";
}

function checkWin3(p) {
    for (let i = 0; i < 3; i++)
        if (board3[i][0] === p && board3[i][1] === p && board3[i][2] === p)
            return true;

    for (let j = 0; j < 3; j++)
        if (board3[0][j] === p && board3[1][j] === p && board3[2][j] === p)
            return true;

    if (board3[0][0] === p && board3[1][1] === p && board3[2][2] === p) return true;
    if (board3[0][2] === p && board3[1][1] === p && board3[2][0] === p) return true;

    return false;
}

function reset3() {
    turn3 = "X";
    init3();
}

init3();

// ===========================
// GAME N×N (nhúng)
// ===========================
let N = 0;
let boardN = [];
let turnN = "X";

function createNBoard() {
    N = parseInt(document.getElementById("sizeN").value);
    if (!N || N < 3) return alert("N phải ≥ 3");

    const area = document.getElementById("nBoardArea");
    area.innerHTML = "";

    const boardDiv = document.createElement("div");
    boardDiv.className = "board";
    boardDiv.style.gridTemplateColumns = `repeat(${N}, 40px)`;
    area.appendChild(boardDiv);

    boardN = Array.from({ length: N }, () => Array(N).fill(""));
    turnN = "X";

    for (let i = 0; i < N; i++)
        for (let j = 0; j < N; j++) {
            const c = document.createElement("div");
            c.className = "cell";
            c.style.width = "40px";
            c.style.height = "40px";
            c.style.fontSize = "26px";

            c.onclick = () => clickN(i, j, c);
            boardDiv.appendChild(c);
        }
}

function clickN(i, j, cell) {
    if (boardN[i][j] !== "") return;

    boardN[i][j] = turnN;
    cell.textContent = turnN;

    if (checkWinN(turnN)) {
        alert(turnN + " thắng!");
        return;
    }

    turnN = turnN === "X" ? "O" : "X";
}

function checkWinN(p) {
    // kiểm tra hàng
    for (let i = 0; i < N; i++)
        for (let j = 0; j < N - 2; j++)
            if (boardN[i][j] === p && boardN[i][j+1] === p && boardN[i][j+2] === p)
                return true;

    // cột
    for (let j = 0; j < N; j++)
        for (let i = 0; i < N - 2; i++)
            if (boardN[i][j] === p && boardN[i+1][j] === p && boardN[i+2][j] === p)
                return true;

    // chéo chính
    for (let i = 0; i < N - 2; i++)
        for (let j = 0; j < N - 2; j++)
            if (boardN[i][j] === p && boardN[i+1][j+1] === p && boardN[i+2][j+2] === p)
                return true;

    // chéo phụ
    for (let i = 0; i < N - 2; i++)
        for (let j = 2; j < N; j++)
            if (boardN[i][j] === p && boardN[i+1][j-1] === p && boardN[i+2][j-2] === p)
                return true;

    return false;
}
</script>

</body>
</html>
